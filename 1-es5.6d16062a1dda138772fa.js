!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"M+tf":function(n,i,a){"use strict";a.r(i),a.d(i,"CreateTimePageModule",(function(){return H}));var r=a("ofXK"),o=a("3Pt+"),s=a("TEn/"),l=a("mrSG"),c=a("u1pB"),d=a("ZiJJ"),p=a("TCge"),m=a("zTSL"),u=a("mYOz"),h=a("fXoL"),g=a("oZWX"),v=a("tyNb"),f=a("E2f4"),S=a("HPR3"),x=a("sYmb"),k=a("SdGS");function I(e,t){if(1&e){var n=h["\u0275\u0275getCurrentView"]();h["\u0275\u0275elementStart"](0,"ion-button",19),h["\u0275\u0275listener"]("click",(function(){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"](2).delete()})),h["\u0275\u0275element"](1,"ion-icon",21),h["\u0275\u0275elementEnd"]()}}function b(e,t){if(1&e){var n=h["\u0275\u0275getCurrentView"]();h["\u0275\u0275elementStart"](0,"ion-buttons",18),h["\u0275\u0275template"](1,I,2,0,"ion-button",8),h["\u0275\u0275elementStart"](2,"ion-button",19),h["\u0275\u0275listener"]("click",(function(){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().save()})),h["\u0275\u0275element"](3,"ion-icon",20),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"]()}if(2&e){var i=h["\u0275\u0275nextContext"]();h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf",i.isUpdate)}}function E(e,t){1&e&&h["\u0275\u0275element"](0,"ion-spinner",22)}function T(e,t){1&e&&(h["\u0275\u0275elementStart"](0,"ion-title"),h["\u0275\u0275text"](1),h["\u0275\u0275pipe"](2,"translate"),h["\u0275\u0275elementEnd"]()),2&e&&(h["\u0275\u0275advance"](1),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](2,1,"Create effort")))}function _(e,t){1&e&&(h["\u0275\u0275elementStart"](0,"ion-title"),h["\u0275\u0275text"](1),h["\u0275\u0275pipe"](2,"translate"),h["\u0275\u0275elementEnd"]()),2&e&&(h["\u0275\u0275advance"](1),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](2,1,"Update effort")))}function C(e,t){if(1&e){var n=h["\u0275\u0275getCurrentView"]();h["\u0275\u0275elementStart"](0,"ion-segment",23),h["\u0275\u0275listener"]("ionChange",(function(e){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().segmentChanged(e)})),h["\u0275\u0275elementStart"](1,"ion-segment-button",24),h["\u0275\u0275elementStart"](2,"ion-label"),h["\u0275\u0275text"](3),h["\u0275\u0275pipe"](4,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](5,"ion-segment-button",25),h["\u0275\u0275elementStart"](6,"ion-label"),h["\u0275\u0275text"](7),h["\u0275\u0275pipe"](8,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"]()}if(2&e){var i=h["\u0275\u0275nextContext"]();h["\u0275\u0275property"]("value",null==i.timesheet||null==i.timesheet.tracking?null:i.timesheet.tracking.type),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](4,3,"Duration")),h["\u0275\u0275advance"](4),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](8,5,"Range"))}}function w(e,t){1&e&&(h["\u0275\u0275elementStart"](0,"ion-label",11),h["\u0275\u0275text"](1),h["\u0275\u0275pipe"](2,"translate"),h["\u0275\u0275elementEnd"]()),2&e&&(h["\u0275\u0275advance"](1),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](2,1,"Date(s)")))}function y(e,t){1&e&&(h["\u0275\u0275elementStart"](0,"ion-label",11),h["\u0275\u0275text"](1),h["\u0275\u0275pipe"](2,"translate"),h["\u0275\u0275elementEnd"]()),2&e&&(h["\u0275\u0275advance"](1),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](2,1,"Date")))}function D(e,t){if(1&e&&(h["\u0275\u0275elementStart"](0,"p"),h["\u0275\u0275text"](1),h["\u0275\u0275pipe"](2,"date"),h["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;h["\u0275\u0275advance"](1),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind2"](2,1,n,"EEEE dd.MM.yyyy"))}}function M(e,t){if(1&e){var n=h["\u0275\u0275getCurrentView"]();h["\u0275\u0275elementStart"](0,"ion-item",19),h["\u0275\u0275listener"]("click",(function(){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().openCalendar()})),h["\u0275\u0275template"](1,w,3,3,"ion-label",26),h["\u0275\u0275template"](2,y,3,3,"ion-label",26),h["\u0275\u0275template"](3,D,3,4,"p",27),h["\u0275\u0275elementEnd"]()}if(2&e){var i=h["\u0275\u0275nextContext"]();h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf",!i.isUpdate),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf",i.isUpdate),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngForOf",i.selectedDates)}}function j(e,t){if(1&e){var n=h["\u0275\u0275getCurrentView"]();h["\u0275\u0275elementStart"](0,"ion-row"),h["\u0275\u0275elementStart"](1,"ion-col"),h["\u0275\u0275elementStart"](2,"ion-item"),h["\u0275\u0275elementStart"](3,"ion-label",11),h["\u0275\u0275text"](4),h["\u0275\u0275pipe"](5,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](6,"ion-datetime",28),h["\u0275\u0275listener"]("ngModelChange",(function(e){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().timesheet.tracking.start=e}))("ionChange",(function(){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().onTimeChanged()})),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](7,"ion-col"),h["\u0275\u0275elementStart"](8,"ion-item"),h["\u0275\u0275elementStart"](9,"ion-label",11),h["\u0275\u0275text"](10),h["\u0275\u0275pipe"](11,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](12,"ion-datetime",29),h["\u0275\u0275listener"]("ngModelChange",(function(e){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().timesheet.tracking.start=e}))("ionChange",(function(){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().onTimeChanged()})),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"]()}if(2&e){var i=h["\u0275\u0275nextContext"]();h["\u0275\u0275advance"](4),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](5,4,"Start")),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",i.timesheet.tracking.start),h["\u0275\u0275advance"](4),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](11,6,"Time")),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",i.timesheet.tracking.start)}}function P(e,t){if(1&e){var n=h["\u0275\u0275getCurrentView"]();h["\u0275\u0275elementStart"](0,"ion-row"),h["\u0275\u0275elementStart"](1,"ion-col"),h["\u0275\u0275elementStart"](2,"ion-item",30),h["\u0275\u0275elementStart"](3,"ion-label",11),h["\u0275\u0275text"](4),h["\u0275\u0275pipe"](5,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](6,"ion-datetime",28),h["\u0275\u0275listener"]("ngModelChange",(function(e){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().timesheet.tracking.end=e}))("ionChange",(function(){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().onTimeChanged()})),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](7,"ion-col"),h["\u0275\u0275elementStart"](8,"ion-item",30),h["\u0275\u0275elementStart"](9,"ion-label",11),h["\u0275\u0275text"](10),h["\u0275\u0275pipe"](11,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](12,"ion-datetime",29),h["\u0275\u0275listener"]("ngModelChange",(function(e){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().timesheet.tracking.end=e}))("ionChange",(function(){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().onTimeChanged()})),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"]()}if(2&e){var i=h["\u0275\u0275nextContext"]();h["\u0275\u0275advance"](4),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](5,4,"End")),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",i.timesheet.tracking.end),h["\u0275\u0275advance"](4),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](11,6,"Time")),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",i.timesheet.tracking.end)}}function R(e,t){if(1&e){var n=h["\u0275\u0275getCurrentView"]();h["\u0275\u0275elementStart"](0,"ion-item",30),h["\u0275\u0275elementStart"](1,"ion-label",11),h["\u0275\u0275text"](2),h["\u0275\u0275pipe"](3,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](4,"span",31),h["\u0275\u0275text"](5),h["\u0275\u0275pipe"](6,"toDuration"),h["\u0275\u0275pipe"](7,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](8,"ion-range",32),h["\u0275\u0275listener"]("ngModelChange",(function(e){return h["\u0275\u0275restoreView"](n),h["\u0275\u0275nextContext"]().selectedDuration=e})),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"]()}if(2&e){var i=h["\u0275\u0275nextContext"]();h["\u0275\u0275advance"](2),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](3,6,"Duration")),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate2"]("",h["\u0275\u0275pipeBind1"](6,8,i.selectedDuration)," ",h["\u0275\u0275pipeBind1"](7,10,"hour(s)"),""),h["\u0275\u0275advance"](3),h["\u0275\u0275property"]("min",i.steps)("step",i.steps)("ngModel",i.selectedDuration)}}function O(e,t){if(1&e&&(h["\u0275\u0275elementStart"](0,"ion-item",30),h["\u0275\u0275elementStart"](1,"ion-label",11),h["\u0275\u0275text"](2),h["\u0275\u0275pipe"](3,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](4,"span",33),h["\u0275\u0275text"](5),h["\u0275\u0275pipe"](6,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"]()),2&e){var n=h["\u0275\u0275nextContext"]();h["\u0275\u0275advance"](2),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](3,3,"Duration")),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate2"]("",null==n.timesheet||null==n.timesheet.tracking?null:n.timesheet.tracking.duration," ",h["\u0275\u0275pipeBind1"](6,5,"hour(s)"),"")}}function N(e,t){if(1&e&&(h["\u0275\u0275elementStart"](0,"ion-select-option",34),h["\u0275\u0275text"](1),h["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;h["\u0275\u0275property"]("value",n.id),h["\u0275\u0275advance"](1),h["\u0275\u0275textInterpolate1"](" ",n.name," ")}}function B(e,t){if(1&e&&(h["\u0275\u0275elementStart"](0,"ion-select-option",34),h["\u0275\u0275text"](1,"\u2730 "),h["\u0275\u0275element"](2,"ion-icon",35),h["\u0275\u0275text"](3),h["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;h["\u0275\u0275propertyInterpolate"]("value",n.id),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate1"](" ",n.name," ")}}function U(e,t){if(1&e&&(h["\u0275\u0275elementStart"](0,"ion-select-option",34),h["\u0275\u0275text"](1),h["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;h["\u0275\u0275propertyInterpolate"]("value",n.id),h["\u0275\u0275advance"](1),h["\u0275\u0275textInterpolate1"]("",n.name," ")}}function V(e,t){if(1&e&&(h["\u0275\u0275elementStart"](0,"ion-select-option",34),h["\u0275\u0275text"](1),h["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;h["\u0275\u0275property"]("value",n.id),h["\u0275\u0275advance"](1),h["\u0275\u0275textInterpolate1"]("",n.name," ")}}var A,L,F=((A=function(){function n(t,i,a,o,s,l,c,p){e(this,n),this.apiService=t,this.router=i,this.route=a,this.storage=o,this.utils=s,this.translateService=l,this.modalContoller=c,this.stopwatchesService=p,this.today=new Date,this.datePipe=new r.DatePipe("en-US"),this.isUpdate=!1,this.isSaving=!1,this.selectedDates=[new Date],this.selectedProjectText=null,this.selectedPackageText=null,this.selectedDuration=1,this.availablePackages=[],this.timesheet=new d.a,this.projects=[],this.clientServices=[],this.timesheetStatus=[],this.steps=1,this.contact=null,this.contactSearch=null,this.init()}var i,a,o;return i=n,(a=[{key:"init",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.getUser();case 2:return t=e.sent,this.timesheet.user_id=t.id,this.timesheet.allowable_bill=!1,e.next=7,this.apiService.getProjects();case 7:return this.projects=e.sent,e.next=10,this.apiService.getClientService();case 10:return this.clientServices=e.sent,e.next=13,this.apiService.getTimesheetStatus();case 13:return this.timesheetStatus=e.sent,this.timesheet.tracking=this.utils.prepareTracking(this.timesheet.tracking),e.next=17,this.storage.getNumber(p.b.SETTINGS_DURATION,p.a.DURATION);case 17:return n=e.sent,this.selectedDuration=n,(i=new Date(this.timesheet.tracking.start)).setMinutes(i.getMinutes()+60*n),this.timesheet.tracking.end=i.toISOString(),this.timesheet.tracking.duration=(new c.a).transform(n),e.next=25,this.storage.getNumber(p.b.SETTINGS_STEPS,p.a.STEPS);case 25:return e.t0=e.sent,this.steps=e.t0/60,e.next=29,this.storage.getString(p.b.SETTINGS_LAST_SERVICE,p.a.SERVICE_ID);case 29:if(e.t1=e.sent,e.t2=p.c.NONE,e.t3=e.t1!=e.t2,!e.t3){e.next=36;break}return e.next=35,this.storage.getNumber(p.b.SETTINGS_LAST_SERVICE_ID);case 35:this.timesheet.client_service_id=e.sent;case 36:return e.next=38,this.storage.getString(p.b.SETTINGS_LAST_STATUS,p.a.STATUS_ID);case 38:if(e.t4=e.sent,e.t5=p.c.NONE,e.t6=e.t4!=e.t5,!e.t6){e.next=45;break}return e.next=44,this.storage.getNumber(p.b.SETTINGS_LAST_STATUS_ID);case 44:this.timesheet.status_id=e.sent;case 45:return e.next=47,this.storage.getString(p.b.SETTINGS_LAST_PROJECT,p.a.PROJECT_ID);case 47:if(e.t7=e.sent,e.t8=p.c.NONE,e.t9=e.t7!=e.t8,!e.t9){e.next=57;break}return e.next=53,this.storage.getNumber(p.b.SETTINGS_LAST_PROJECT_ID);case 53:return this.timesheet.pr_project_id=e.sent,e.next=56,this.apiService.getPackagesForProject(this.timesheet.pr_project_id);case 56:this.availablePackages=e.sent;case 57:this.route.params.subscribe((function(e){return Object(l.a)(a,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.stopwatch_id){t.next=11;break}return t.next=3,this.stopwatchesService.get(e.stopwatch_id);case 3:return n=t.sent,n=Object.assign(new u.a,n),t.t0=n,t.next=8,this.apiService.getUser();case 8:t.t1=t.sent.id,this.timesheet=t.t0.toTimesheet.call(t.t0,t.t1),this.selectedDuration=this.utils.parseDuration(this.timesheet.tracking.duration);case 11:if(t.t2=e.project_id,!t.t2){t.next=17;break}return this.timesheet.pr_project_id=parseInt(e.project_id),t.next=16,this.apiService.getPackagesForProject(this.timesheet.pr_project_id);case 16:this.availablePackages=t.sent;case 17:if(e.package_id&&(this.timesheet.pr_package_id=parseInt(e.package_id)),!e.time_id){t.next=34;break}return this.isUpdate=!0,t.prev=20,t.next=23,this.apiService.getTimesheet(parseInt(e.time_id),!0);case 23:return this.timesheet=t.sent,this.selectedDates=[new Date(this.timesheet.date)],this.selectedDuration=this.utils.parseDuration(this.timesheet.duration),t.next=28,this.apiService.getPackagesForProject(this.timesheet.pr_project_id);case 28:this.availablePackages=t.sent,t.next=34;break;case 31:t.prev=31,t.t3=t.catch(20),console.error("error",t.t3);case 34:this.updateSelectTexts();case 35:case"end":return t.stop()}}),t,this,[[20,31]])})))}));case 58:case"end":return e.stop()}}),e,this)})))}},{key:"updateSelectTexts",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.projects.filter((function(e){return e.id==n.timesheet.pr_project_id})),e.t0=t.length>0,!e.t0){e.next=10;break}if(this.selectedProjectText=t[0].name,this.timesheet.contact_id=t[0].contact_id,e.t1=this.timesheet.pr_package_id,!e.t1){e.next=10;break}return e.next=9,this.apiService.getPackageForProjectWithId(this.timesheet.pr_project_id,this.timesheet.pr_package_id);case 9:this.selectedPackageText=e.sent.name;case 10:case"end":return e.stop()}}),e,this)})))}},{key:"onProjectSelected",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.getPackagesForProject(this.timesheet.pr_project_id);case 2:this.availablePackages=e.sent,this.updateSelectTexts();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"save",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("timesheet",this.timesheet),this.isSaving=!0,null!=this.contact&&(this.timesheet.contact_id=this.contact.id),!this.isUpdate){e.next=8;break}return e.next=6,this.update();case 6:e.next=10;break;case 8:return e.next=10,this.create();case 10:this.isSaving=!1;case 11:case"end":return e.stop()}}),e,this)})))}},{key:"contactChange",value:function(e){console.log("port:",e.value)}},{key:"searchContact",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.text.trim().toLowerCase(),e.component.startSearch(),t.next=4,this.apiService.searchContact(n);case 4:e.component.items=t.sent,e.component.endSearch();case 6:case"end":return t.stop()}}),t,this)})))}},{key:"validateTime",value:function(){return!this.timesheet.client_service_id||!this.timesheet.status_id||!this.timesheet.text||this.timesheet.text.length<1?(this.utils.showToast("Missing information"),!1):(this.timesheet.tracking.duration=(new c.a).transform(this.selectedDuration),!0)}},{key:"onTimeChanged",value:function(){if("range"===this.timesheet.tracking.type){var e=(Date.parse(this.timesheet.tracking.end)-Date.parse(this.timesheet.tracking.start))/36e5;this.timesheet.tracking.duration=(new c.a).transform(e),this.selectedDuration=(new c.a).transform(e)}}},{key:"segmentChanged",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.timesheet.tracking.type="duration"===e.detail.value?"duration":"range",console.log("changed type to "+e.detail.value),console.log("timesheet",this.timesheet);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"storeLastUsed",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.storage.getString(p.b.SETTINGS_LAST_PROJECT,p.a.PROJECT_ID);case 2:if(t.t0=t.sent,t.t1=p.c.LAST_USED,t.t2=t.t0===t.t1,!t.t2){t.next=7;break}this.storage.setItem(p.b.SETTINGS_LAST_PROJECT_ID,e.pr_project_id);case 7:return t.next=9,this.storage.getString(p.b.SETTINGS_LAST_STATUS,p.a.STATUS_ID);case 9:if(t.t3=t.sent,t.t4=p.c.LAST_USED,t.t5=t.t3===t.t4,!t.t5){t.next=14;break}this.storage.setItem(p.b.SETTINGS_LAST_STATUS_ID,e.status_id);case 14:return t.next=16,this.storage.getString(p.b.SETTINGS_LAST_SERVICE,p.a.SERVICE_ID);case 16:if(t.t6=t.sent,t.t7=p.c.LAST_USED,t.t8=t.t6===t.t7,!t.t8){t.next=21;break}this.storage.setItem(p.b.SETTINGS_LAST_SERVICE_ID,e.client_service_id);case 21:case"end":return t.stop()}}),t,this)})))}},{key:"update",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.validateTime()?(t.timesheet.tracking.date=t.datePipe.transform(t.selectedDates[0],"yyyy-MM-dd"),t.apiService.putTimesheet(t.timesheet).then((function(n){return Object(l.a)(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.storeLastUsed(n),this.utils.showToast("Updated"),this.router.navigateByUrl("tabs",{skipLocationChange:!0}),e();case 1:case"end":return t.stop()}}),t,this)})))})).catch((function(n){return Object(l.a)(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.utils.showToast("Failed: "+n.message),e();case 1:case"end":return t.stop()}}),t,this)})))}))):e()})));case 1:case"end":return e.stop()}}),e)})))}},{key:"openCalendar",value:function(){var e;return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,i,a,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=new Date("2018-01-01"),t.t1=new Date,t.next=4,this.translateService.get("Select date(s)").toPromise();case 4:if(t.t2=t.sent,t.t3=this.selectedDates,t.t4=this.selectedDates[0],n={from:t.t0,defaultScrollTo:t.t1,pickMode:"multi",title:t.t2,color:"primary",weekStart:1,defaultDates:t.t3,defaultDate:t.t4},t.t5=this.isUpdate,!t.t5){t.next=15;break}return n.pickMode="single",n.defaultDate=this.selectedDates[0],t.next=14,this.translateService.get("Date").toPromise();case 14:n.title=t.sent;case 15:return t.next=17,this.modalContoller.create({component:m.CalendarModal,componentProps:{options:n}});case 17:return(i=t.sent).present(),t.next=21,i.onDidDismiss();case 21:if(a=t.sent,this.isUpdate)this.selectedDates=[null===(e=a.data)||void 0===e?void 0:e.dateObj];else{for(r=[],o=0;o<a.data.length;o++)a.data[o]&&r.push(a.data[o].dateObj);this.selectedDates=r}case 23:case"end":return t.stop()}}),t,this)})))}},{key:"create",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return Object(l.a)(t,void 0,void 0,regeneratorRuntime.mark((function t(){var n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.validateTime()){t.next=11;break}n=0;case 2:if(!(n<this.selectedDates.length)){t.next=10;break}return(i=JSON.parse(JSON.stringify(this.timesheet))).tracking.date=this.datePipe.transform(this.selectedDates[n],"yyyy-MM-dd"),t.next=7,this.apiService.postTimesheet(i);case 7:n++,t.next=2;break;case 10:this.storeLastUsed(this.timesheet),this.utils.showToast("Created"),this.router.navigateByUrl("tabs",{skipLocationChange:!0});case 11:e();case 12:case"end":return t.stop()}}),t,this)})))})));case 1:case"end":return e.stop()}}),e)})))}},{key:"delete",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.utils.confirm("Delete time entry","Are you sure?");case 2:if(e.t0=e.sent,!e.t0){e.next=8;break}return e.next=6,this.apiService.deleteTimesheet(this.timesheet.id);case 6:this.utils.showToast("Deleted"),this.router.navigateByUrl("/tabs/times");case 8:case"end":return e.stop()}}),e,this)})))}}])&&t(i.prototype,a),o&&t(i,o),n}()).\u0275fac=function(e){return new(e||A)(h["\u0275\u0275directiveInject"](g.a),h["\u0275\u0275directiveInject"](v.g),h["\u0275\u0275directiveInject"](v.a),h["\u0275\u0275directiveInject"](f.a),h["\u0275\u0275directiveInject"](S.a),h["\u0275\u0275directiveInject"](x.d),h["\u0275\u0275directiveInject"](s.ModalController),h["\u0275\u0275directiveInject"](k.a))},A.\u0275cmp=h["\u0275\u0275defineComponent"]({type:A,selectors:[["app-time"]],decls:51,vars:40,consts:[["color","primary"],["slot","start"],["mode","md","defaultHref","/tabs/projects"],["slot","end",4,"ngIf"],["slot","end","color","light",4,"ngIf"],[4,"ngIf"],[1,"type"],["mode","ios",3,"value","ionChange",4,"ngIf"],[3,"click",4,"ngIf"],["lines","none",4,"ngIf"],[3,"ngModel","ngModelChange"],["position","stacked"],["placeholder","Select","interface","popover",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["position","floating"],["placeholder","Project",3,"ngModel","selectedText","ionChange","ngModelChange"],["placeholder","Package",3,"ngModel","selectedText","ngModelChange"],["autoGrow","true","placeholder","Text",3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["slot","icon-only","name","save"],["slot","icon-only","name","trash-outline"],["slot","end","color","light"],["mode","ios",3,"value","ionChange"],["value","duration"],["value","range"],["position","stacked",4,"ngIf"],[4,"ngFor","ngForOf"],["displayFormat","DDDD MMM D, YYYY",3,"ngModel","ngModelChange","ionChange"],["displayFormat","HH:mm",3,"ngModel","ngModelChange","ionChange"],["lines","none"],[2,"width","100%","text-align","center","padding","16px"],["max","12","snaps","true","ticks","false",3,"min","step","ngModel","ngModelChange"],[2,"width","100%","text-align","center"],[3,"value"],["name","funnel-outline"]],template:function(e,t){1&e&&(h["\u0275\u0275elementStart"](0,"ion-header"),h["\u0275\u0275elementStart"](1,"ion-toolbar",0),h["\u0275\u0275elementStart"](2,"ion-buttons",1),h["\u0275\u0275element"](3,"ion-back-button",2),h["\u0275\u0275elementEnd"](),h["\u0275\u0275template"](4,b,4,1,"ion-buttons",3),h["\u0275\u0275template"](5,E,1,0,"ion-spinner",4),h["\u0275\u0275template"](6,T,3,3,"ion-title",5),h["\u0275\u0275template"](7,_,3,3,"ion-title",5),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](8,"ion-content"),h["\u0275\u0275elementStart"](9,"ion-list"),h["\u0275\u0275elementStart"](10,"div",6),h["\u0275\u0275template"](11,C,9,7,"ion-segment",7),h["\u0275\u0275template"](12,M,4,3,"ion-item",8),h["\u0275\u0275template"](13,j,13,8,"ion-row",5),h["\u0275\u0275template"](14,P,13,8,"ion-row",5),h["\u0275\u0275template"](15,R,9,12,"ion-item",9),h["\u0275\u0275template"](16,O,7,7,"ion-item",9),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](17,"ion-item"),h["\u0275\u0275elementStart"](18,"ion-label"),h["\u0275\u0275text"](19),h["\u0275\u0275pipe"](20,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](21,"ion-toggle",10),h["\u0275\u0275listener"]("ngModelChange",(function(e){return t.timesheet.allowable_bill=e})),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](22,"ion-item"),h["\u0275\u0275elementStart"](23,"ion-label",11),h["\u0275\u0275text"](24),h["\u0275\u0275pipe"](25,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](26,"ion-select",12),h["\u0275\u0275listener"]("ngModelChange",(function(e){return t.timesheet.client_service_id=e})),h["\u0275\u0275template"](27,N,2,2,"ion-select-option",13),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](28,"ion-item"),h["\u0275\u0275elementStart"](29,"ion-label",14),h["\u0275\u0275text"](30),h["\u0275\u0275pipe"](31,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](32,"ion-select",15),h["\u0275\u0275listener"]("ionChange",(function(){return t.onProjectSelected()}))("ngModelChange",(function(e){return t.timesheet.pr_project_id=e})),h["\u0275\u0275template"](33,B,4,2,"ion-select-option",13),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](34,"ion-item"),h["\u0275\u0275elementStart"](35,"ion-label",14),h["\u0275\u0275text"](36),h["\u0275\u0275pipe"](37,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](38,"ion-select",16),h["\u0275\u0275listener"]("ngModelChange",(function(e){return t.timesheet.pr_package_id=e})),h["\u0275\u0275template"](39,U,2,2,"ion-select-option",13),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](40,"ion-item"),h["\u0275\u0275elementStart"](41,"ion-label",11),h["\u0275\u0275text"](42),h["\u0275\u0275pipe"](43,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](44,"ion-select",12),h["\u0275\u0275listener"]("ngModelChange",(function(e){return t.timesheet.status_id=e})),h["\u0275\u0275template"](45,V,2,2,"ion-select-option",13),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](46,"ion-item"),h["\u0275\u0275elementStart"](47,"ion-label",11),h["\u0275\u0275text"](48),h["\u0275\u0275pipe"](49,"translate"),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementStart"](50,"ion-textarea",17),h["\u0275\u0275listener"]("ngModelChange",(function(e){return t.timesheet.text=e})),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"](),h["\u0275\u0275elementEnd"]()),2&e&&(h["\u0275\u0275advance"](4),h["\u0275\u0275property"]("ngIf",!t.isSaving),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf",t.isSaving),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf",!t.isUpdate),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf",t.isUpdate),h["\u0275\u0275advance"](4),h["\u0275\u0275property"]("ngIf",!t.isUpdate),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf","duration"==(null==t.timesheet||null==t.timesheet.tracking?null:t.timesheet.tracking.type)),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf","range"==(null==t.timesheet||null==t.timesheet.tracking?null:t.timesheet.tracking.type)),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf","range"==(null==t.timesheet||null==t.timesheet.tracking?null:t.timesheet.tracking.type)),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf","duration"==(null==t.timesheet||null==t.timesheet.tracking?null:t.timesheet.tracking.type)),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngIf","range"==(null==t.timesheet||null==t.timesheet.tracking?null:t.timesheet.tracking.type)),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](20,28,"Chargeable")),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",t.timesheet.allowable_bill),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate1"]("",h["\u0275\u0275pipeBind1"](25,30,"Service"),"*"),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",t.timesheet.client_service_id),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngForOf",t.clientServices),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](31,32,"Project")),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",t.timesheet.pr_project_id)("selectedText",t.selectedProjectText),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngForOf",t.projects),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate"](h["\u0275\u0275pipeBind1"](37,34,"Package")),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",t.timesheet.pr_package_id)("selectedText",t.selectedPackageText),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngForOf",t.availablePackages),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate1"]("",h["\u0275\u0275pipeBind1"](43,36,"Status"),"*"),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",t.timesheet.status_id),h["\u0275\u0275advance"](1),h["\u0275\u0275property"]("ngForOf",t.timesheetStatus),h["\u0275\u0275advance"](3),h["\u0275\u0275textInterpolate1"]("",h["\u0275\u0275pipeBind1"](49,38,"Description"),"*"),h["\u0275\u0275advance"](2),h["\u0275\u0275property"]("ngModel",t.timesheet.text))},directives:[s.IonHeader,s.IonToolbar,s.IonButtons,s.IonBackButton,s.IonBackButtonDelegate,r.NgIf,s.IonContent,s.IonList,s.IonItem,s.IonLabel,s.IonToggle,s.BooleanValueAccessor,o.NgControlStatus,o.NgModel,s.IonSelect,s.SelectValueAccessor,r.NgForOf,s.IonTextarea,s.TextValueAccessor,s.IonButton,s.IonIcon,s.IonSpinner,s.IonTitle,s.IonSegment,s.IonSegmentButton,s.IonRow,s.IonCol,s.IonDatetime,s.IonRange,s.IonSelectOption],pipes:[x.c,r.DatePipe,c.a],styles:["ion-spinner[_ngcontent-%COMP%]{margin-right:12px}ion-item[_ngcontent-%COMP%]{--ion-background-color:transparent}.type[_ngcontent-%COMP%]{margin:8px;padding:8px;border-radius:7px;background-color:#eee}"]}),A),G=a("iTUp"),J=a("CH/f"),H=((L=function t(){e(this,t)}).\u0275mod=h["\u0275\u0275defineNgModule"]({type:L}),L.\u0275inj=h["\u0275\u0275defineInjector"]({factory:function(e){return new(e||L)},imports:[[r.CommonModule,o.FormsModule,s.IonicModule,x.b,G.a,J.a,v.i.forChild([{path:"",component:F}])]]}),L)}}])}();