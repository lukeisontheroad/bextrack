"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5868],{5868:(V,T,p)=>{p.r(T),p.d(T,{StopwatchesPageModule:()=>B});var d=p(177),C=p(9417),a=p(4742),w=p(3955),y=p(5553),g=p(3871),h=p(467),t=p(6996),b=p(5083),f=p(8),R=p(7316),_=p(5217),E=p(9893),S=p(7897),P=p(6929),v=p(2872);function F(o,r){1&o&&(t.j41(0,"ion-avatar",11),t.nrm(1,"img",12),t.k0s())}function j(o,r){1&o&&(t.j41(0,"ion-avatar",11),t.nrm(1,"img",13),t.k0s())}function D(o,r){if(1&o&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o){const s=t.XpG();t.R7$(1),t.Lme("",t.bMT(2,2,"Project"),": ",null==s.stopwatch?null:s.stopwatch.selectedProjectText,"")}}function k(o,r){if(1&o&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o){const s=t.XpG();t.R7$(1),t.Lme("",t.bMT(2,2,"Package"),": ",null==s.stopwatch?null:s.stopwatch.selectedPackageText,"")}}function G(o,r){if(1&o&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o){const s=t.XpG();t.R7$(1),t.Lme("",t.bMT(2,2,"Service"),": ",null==s.stopwatch?null:s.stopwatch.selectedClientServiceText,"")}}function N(o,r){if(1&o&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o){const s=t.XpG();t.R7$(1),t.Lme("",t.bMT(2,2,"Status"),": ",null==s.stopwatch?null:s.stopwatch.selectedStatusText,"")}}function A(o,r){if(1&o){const s=t.RV6();t.j41(0,"ion-button",14),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.startTimer())}),t.nrm(1,"ion-icon",15),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&o&&(t.R7$(2),t.SpI("\xa0",t.bMT(3,1,"Start"),""))}function M(o,r){if(1&o){const s=t.RV6();t.j41(0,"ion-button",14),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.startTimer())}),t.nrm(1,"ion-icon",15),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&o&&(t.R7$(2),t.SpI("\xa0",t.bMT(3,1,"Continue"),""))}function $(o,r){if(1&o){const s=t.RV6();t.j41(0,"ion-button",16),t.bIt("click",function(){t.eBV(s);const n=t.XpG();return t.Njj(n.pauseTimer())}),t.nrm(1,"ion-icon",17),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&o&&(t.R7$(2),t.SpI("\xa0",t.bMT(3,1,"Pause"),""))}const{LocalNotifications:O}=b.ry;let I=(()=>{var o;class r{constructor(e,n,i,c,l,u,m){this.translateService=e,this.storage=n,this.utils=i,this.stopwatchesService=c,this.apiService=l,this.alertController=u,this.navController=m,this.onEdit=new t.bkB,this.onDelete=new t.bkB,this.timerDisplay="00:00:00",this.difference=0,this.savedTime=0,this.paused=0,this.running=0,this.resolution=100}ngOnInit(){var e=this;return(0,h.A)(function*(){yield e.loadCurrentState(),1===e.running&&0===e.paused&&(e.tInterval=setInterval(()=>{e.getShowTime()},e.resolution))})()}edit(){var e=this;return(0,h.A)(function*(){e.onEdit.emit(e.stopwatch.id)})()}delete(){var e=this;return(0,h.A)(function*(){(yield e.utils.confirm("Are you sure?","Delete "+e.stopwatch.title))?(yield e.stopwatchesService.delete(e.stopwatch),e.utils.showToast("Deleted"),e.onDelete.emit(!0)):e.onDelete.emit(!1)})()}startTimer(){this.startTime=(new Date).getTime(),this.tInterval=setInterval(()=>{this.getShowTime()},this.resolution),this.paused=0,this.running=1,this.saveCurrentState(),this.startNotification(),this.stopwatchesService.setCurrentStopwatch(this.stopwatch)}loadItem(e){var n=this;return new Promise(function(){var i=(0,h.A)(function*(c){const l=yield n.storage.getString(n.stopwatch.id+"_"+e,null);null!==l&&(n[e+""]="number"==typeof n[e+""]?parseFloat(l):l),c()});return function(c){return i.apply(this,arguments)}}())}saveItem(e,n){return this.storage.setItem(this.stopwatch.id+"_"+e,n)}loadCurrentState(){var e=this;return(0,h.A)(function*(){return new Promise(function(){var n=(0,h.A)(function*(i){const c=[];for(let l=0;l<f.O3.STOPWATCHES_FIELDS.length;l++)c.push(e.loadItem(f.O3.STOPWATCHES_FIELDS[l]));yield Promise.all(c),i()});return function(i){return n.apply(this,arguments)}}())})()}saveCurrentState(){var e=this;return(0,h.A)(function*(){const n=[];for(let i=0;i<f.O3.STOPWATCHES_FIELDS.length;i++){const c=f.O3.STOPWATCHES_FIELDS[i];n.push(e.saveItem(c,e[c]))}yield Promise.all(n)})()}pauseTimer(){this.difference&&(this.paused||(clearInterval(this.tInterval),this.savedTime=this.difference,this.paused=1,this.running=0,this.saveCurrentState(),this.stopNotification()))}processTimesheet(){var e=this;return(0,h.A)(function*(){return new Promise(function(){var n=(0,h.A)(function*(i){var l;0===e.difference?(i(!0),e.navController.navigateRoot("/create-time/stopwatch/"+e.stopwatch.id)):0===e.stopwatch.strategy?(e.pauseTimer(),(yield e.alertController.create({header:"Create time",message:"Do you want to edit the timeentry before creating it?",buttons:[{text:"Edit before create",handler:(l=(0,h.A)(function*(){i(!0),e.navController.navigateRoot("/create-time/stopwatch/"+e.stopwatch.id)}),function(){return l.apply(this,arguments)})},{text:"Create without edit",handler:()=>{i(!0),e.createTimesheet()}},{text:"Continue stopwatch",role:"cancel",handler:()=>{e.startTimer()}},{text:"Reset stopwatch",cssClass:"secondary",handler:()=>{i(!0)}}]})).present()):1===e.stopwatch.strategy?(yield e.createTimesheet(),i(!0)):2===e.stopwatch.strategy?(e.navController.navigateRoot("/create-time/stopwatch/"+e.stopwatch.id),i(!0)):(console.error("Strategy not implemented"),i(!1))});return function(i){return n.apply(this,arguments)}}())})()}createTimesheet(){var e=this;return new Promise(function(){var n=(0,h.A)(function*(i){let c=yield e.stopwatchesService.get(e.stopwatch.id);c=Object.assign(new R.e,e.stopwatch);const l=yield c.toTimesheet((yield e.apiService.getUser()).id),u=60*(yield e.storage.getNumber(f.O3.SETTINGS_STEPS)),m=c.timerDisplay.split(":").map(L=>parseInt(L,10));m[0]>0||m[1]>=u/60?(yield e.apiService.postTimesheet(l),e.utils.showToast("Time entry created"),i(!0)):(e.utils.showToast("Duration below minimum tracking time of "+u/60+"min"),i(!1))});return function(i){return n.apply(this,arguments)}}())}stopTimer(){var e=this;return(0,h.A)(function*(){(yield e.processTimesheet())?(clearInterval(e.tInterval),e.savedTime=0,e.difference=0,e.paused=0,e.running=0,e.timerDisplay="00:00:00",e.stopNotification(),setTimeout(()=>{e.saveCurrentState()},1e3)):e.pauseTimer()})()}getShowTime(){this.updatedTime=(new Date).getTime(),this.difference=this.savedTime?this.updatedTime-this.startTime+this.savedTime:this.updatedTime-this.startTime;const e=Math.floor(this.difference%864e5/36e5),n=Math.floor(this.difference%36e5/6e4),i=Math.floor(this.difference%6e4/1e3);this.timerDisplay=(e<10?"0"+e:e)+":"+(n<10?"0"+n:n)+":"+(i<10?"0"+i:i)}startNotification(){var e=this;return(0,h.A)(function*(){if(console.log("Start notification"),yield O.requestPermission())try{cordova.plugins.notification.local.schedule({id:parseInt("0x"+e.stopwatch.id.substring(0,8),10),title:yield e.translateService.get("BexTrack").toPromise(),text:yield e.translateService.get("timewatch-is-running").toPromise(),sticky:!0,ongoing:!0,autoClear:!1})}catch(n){console.error("Notificaiton error",n)}else console.warn("No notification permission")})()}stopNotification(){var e=this;return(0,h.A)(function*(){console.log("Stop notification");try{cordova.plugins.notification.local.cancel(parseInt("0x"+e.stopwatch.id.substring(0,8),10))}catch(n){console.error("Notificaiton error",n)}})()}}return(o=r).\u0275fac=function(e){return new(e||o)(t.rXU(w.c$),t.rXU(_.n),t.rXU(E.T),t.rXU(S.x),t.rXU(P.G),t.rXU(a.hG),t.rXU(v.q9))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-stopwatch-template"]],inputs:{stopwatch:"stopwatch"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:33,vars:24,consts:[["slot","start",4,"ngIf"],[4,"ngIf"],["slot","end",1,"controls"],["slot","end",3,"click",4,"ngIf"],["slot","end","color","warning",3,"click",4,"ngIf"],["fill","clear","slot","end"],["color","secondary","slot","end","slot","end",3,"click"],["name","create-outline"],["side","end"],["color","warning",3,"click"],["color","danger",3,"click"],["slot","start"],["src","/assets/paid.png"],["src","/assets/free.png"],["slot","end",3,"click"],["name","play-outline"],["slot","end","color","warning",3,"click"],["name","pause-outline"]],template:function(e,n){1&e&&(t.j41(0,"ion-item-sliding")(1,"ion-item"),t.DNE(2,F,2,0,"ion-avatar",0),t.DNE(3,j,2,0,"ion-avatar",0),t.j41(4,"ion-label")(5,"h2"),t.EFF(6),t.k0s(),t.DNE(7,D,3,4,"p",1),t.DNE(8,k,3,4,"p",1),t.DNE(9,G,3,4,"p",1),t.DNE(10,N,3,4,"p",1),t.j41(11,"p"),t.EFF(12),t.nI1(13,"translate"),t.k0s()(),t.j41(14,"div",2),t.DNE(15,A,4,3,"ion-button",3),t.DNE(16,M,4,3,"ion-button",3),t.DNE(17,$,4,3,"ion-button",4),t.nrm(18,"br"),t.j41(19,"ion-button",5),t.EFF(20),t.k0s(),t.nrm(21,"br"),t.j41(22,"ion-button",6),t.bIt("click",function(){return n.stopTimer()}),t.nrm(23,"ion-icon",7),t.EFF(24),t.nI1(25,"translate"),t.k0s()()(),t.j41(26,"ion-item-options",8)(27,"ion-item-option",9),t.bIt("click",function(){return n.edit()}),t.EFF(28),t.nI1(29,"translate"),t.k0s(),t.j41(30,"ion-item-option",10),t.bIt("click",function(){return n.delete()}),t.EFF(31),t.nI1(32,"translate"),t.k0s()()()),2&e&&(t.R7$(2),t.Y8G("ngIf",n.stopwatch.allowable_bill),t.R7$(1),t.Y8G("ngIf",!n.stopwatch.allowable_bill),t.R7$(3),t.JRh(null==n.stopwatch?null:n.stopwatch.title),t.R7$(1),t.Y8G("ngIf",null==n.stopwatch?null:n.stopwatch.selectedProjectText),t.R7$(1),t.Y8G("ngIf",null==n.stopwatch?null:n.stopwatch.selectedPackageText),t.R7$(1),t.Y8G("ngIf",null==n.stopwatch?null:n.stopwatch.selectedClientServiceText),t.R7$(1),t.Y8G("ngIf",null==n.stopwatch?null:n.stopwatch.selectedStatusText),t.R7$(2),t.Lme("",t.bMT(13,16,"Description"),": ",null==n.stopwatch?null:n.stopwatch.text,""),t.R7$(3),t.Y8G("ngIf",0==n.difference&&(0===n.running||1===n.paused)),t.R7$(1),t.Y8G("ngIf",n.difference>0&&(0===n.running||1===n.paused)),t.R7$(1),t.Y8G("ngIf",1===n.running&&1!==n.paused),t.R7$(3),t.JRh(n.timerDisplay),t.R7$(4),t.SpI("\xa0",t.bMT(25,18,"Create"),""),t.R7$(4),t.JRh(t.bMT(29,20,"Edit")),t.R7$(3),t.JRh(t.bMT(32,22,"Delete")))},dependencies:[d.bT,a.mC,a.Jm,a.iq,a.uz,a.LU,a.CE,a.A7,a.he,w.D9],styles:["ion-button[_ngcontent-%COMP%]{width:110px;height:30px}h2[_ngcontent-%COMP%]{font-weight:700}"]}),r})();function X(o,r){1&o&&(t.j41(0,"div",7)(1,"ion-grid")(2,"ion-row"),t.nrm(3,"ion-icon",8),t.k0s(),t.j41(4,"ion-row")(5,"h1"),t.EFF(6),t.nI1(7,"translate"),t.k0s()()()()),2&o&&(t.R7$(6),t.JRh(t.bMT(7,1,"No stopwatches found")))}function x(o,r){if(1&o){const s=t.RV6();t.j41(0,"app-stopwatch-template",9),t.bIt("onDelete",function(n){t.eBV(s);const i=t.XpG();return t.Njj(i.delete(n))})("onEdit",function(n){t.eBV(s);const i=t.XpG();return t.Njj(i.edit(n))}),t.k0s()}2&o&&t.Y8G("stopwatch",r.$implicit)}const U=[{path:"",component:(()=>{var o;class r{constructor(e,n,i){var c=this;this.navController=e,this.stopwatchesService=n,this.storage=i,this.stopwatches=[],this.loading=!1,this.stopwatchesService.stopwatches.subscribe(l=>this.stopwatches=l),this.stopwatchesService.getCurrentStopwatch().subscribe(function(){var l=(0,h.A)(function*(u){(yield c.storage.getBoolean(f.O3.SETTINGS_STOPWATCH_SINGULAR,f.zY.STOPWATCH_SINGULAR))&&c.stopwatchComponents.filter(m=>m.stopwatch.id!==u.id).map(m=>m.pauseTimer())});return function(u){return l.apply(this,arguments)}}())}doRefresh(e){var n=this;return(0,h.A)(function*(){n.loading=!0,e&&e.target.complete(),setTimeout(()=>{n.loading=!1},1e3)})()}delete(e){var n=this;return(0,h.A)(function*(){e||n.list.closeSlidingItems()})()}edit(e){var n=this;return(0,h.A)(function*(){n.navController.navigateRoot("/stopwatch/"+e)})()}}return(o=r).\u0275fac=function(e){return new(e||o)(t.rXU(v.q9),t.rXU(S.x),t.rXU(_.n))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-stopwatches"]],viewQuery:function(e,n){if(1&e&&(t.GBs(a.nf,7),t.GBs(I,5)),2&e){let i;t.mGM(i=t.lsd())&&(n.list=i.first),t.mGM(i=t.lsd())&&(n.stopwatchComponents=i)}},decls:14,vars:5,consts:[["color","primary"],["slot","fixed",3,"ionRefresh"],["class","no-items",4,"ngIf"],[3,"stopwatch","onDelete","onEdit",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed"],["routerLink","/stopwatch/","color","secondary"],["name","add"],[1,"no-items"],["name","stopwatch-outline"],[3,"stopwatch","onDelete","onEdit"]],template:function(e,n){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t.EFF(3),t.nI1(4,"translate"),t.k0s()()(),t.j41(5,"ion-content")(6,"ion-refresher",1),t.bIt("ionRefresh",function(c){return n.doRefresh(c)}),t.nrm(7,"ion-refresher-content"),t.k0s(),t.DNE(8,X,8,3,"div",2),t.j41(9,"ion-list"),t.DNE(10,x,1,1,"app-stopwatch-template",3),t.k0s(),t.j41(11,"ion-fab",4)(12,"ion-fab-button",5),t.nrm(13,"ion-icon",6),t.k0s()()()),2&e&&(t.R7$(3),t.SpI(" ",t.bMT(4,3,"Stopwatches")," "),t.R7$(5),t.Y8G("ngIf",0===n.stopwatches.length&&!n.loading),t.R7$(2),t.Y8G("ngForOf",n.stopwatches))},dependencies:[d.Sq,d.bT,a.W9,a.Q8,a.YW,a.lO,a.eU,a.iq,a.nf,a.To,a.Ki,a.ln,a.BC,a.ai,a.N7,I,g.Wk,w.D9]}),r})()}];let Y=(()=>{var o;class r{}return(o=r).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[g.iI.forChild(U),g.iI]}),r})(),B=(()=>{var o;class r{}return(o=r).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[d.MD,C.YN,a.bv,y.h,w.h,Y]}),r})()}}]);