"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8935],{8935:(W,v,p)=>{p.r(v),p.d(v,{StopwatchesPageModule:()=>L});var d=p(6895),T=p(4006),a=p(8058),w=p(2835),c=p(5861),t=p(8274),I=p(7423),C=p(1052),h=p(7432),f=p(2466),g=p(6578),y=p(9265),S=p(3018),x=p(5146);function P(o,s){1&o&&(t.\u0275\u0275elementStart(0,"ion-avatar",11),t.\u0275\u0275element(1,"img",12),t.\u0275\u0275elementEnd())}function E(o,s){1&o&&(t.\u0275\u0275elementStart(0,"ion-avatar",11),t.\u0275\u0275element(1,"img",13),t.\u0275\u0275elementEnd())}function b(o,s){if(1&o&&(t.\u0275\u0275elementStart(0,"p"),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275elementEnd()),2&o){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate2("",t.\u0275\u0275pipeBind1(2,2,"Project"),": ",null==e.stopwatch?null:e.stopwatch.selectedProjectText,"")}}function D(o,s){if(1&o&&(t.\u0275\u0275elementStart(0,"p"),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275elementEnd()),2&o){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate2("",t.\u0275\u0275pipeBind1(2,2,"Package"),": ",null==e.stopwatch?null:e.stopwatch.selectedPackageText,"")}}function N(o,s){if(1&o&&(t.\u0275\u0275elementStart(0,"p"),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275elementEnd()),2&o){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate2("",t.\u0275\u0275pipeBind1(2,2,"Service"),": ",null==e.stopwatch?null:e.stopwatch.selectedClientServiceText,"")}}function R(o,s){if(1&o&&(t.\u0275\u0275elementStart(0,"p"),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275elementEnd()),2&o){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate2("",t.\u0275\u0275pipeBind1(2,2,"Status"),": ",null==e.stopwatch?null:e.stopwatch.selectedStatusText,"")}}function B(o,s){if(1&o){const e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"ion-button",14),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(e);const i=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(i.startTimer())}),t.\u0275\u0275element(1,"ion-icon",15),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()}2&o&&(t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1("\xa0",t.\u0275\u0275pipeBind1(3,1,"Start"),""))}function j(o,s){if(1&o){const e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"ion-button",14),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(e);const i=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(i.startTimer())}),t.\u0275\u0275element(1,"ion-icon",15),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()}2&o&&(t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1("\xa0",t.\u0275\u0275pipeBind1(3,1,"Continue"),""))}function M(o,s){if(1&o){const e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"ion-button",16),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(e);const i=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(i.pauseTimer())}),t.\u0275\u0275element(1,"ion-icon",17),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()}2&o&&(t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1("\xa0",t.\u0275\u0275pipeBind1(3,1,"Pause"),""))}const{LocalNotifications:Z}=I.Vn;let _=(()=>{class o{constructor(e,n,i,r,l,u,m){this.translateService=e,this.storage=n,this.utils=i,this.stopwatchesService=r,this.apiService=l,this.alertController=u,this.navController=m,this.onEdit=new t.EventEmitter,this.onDelete=new t.EventEmitter,this.timerDisplay="00:00:00",this.difference=0,this.savedTime=0,this.paused=0,this.running=0,this.resolution=100}ngOnInit(){var e=this;return(0,c.Z)(function*(){yield e.loadCurrentState(),1===e.running&&0===e.paused&&(e.tInterval=setInterval(()=>{e.getShowTime()},e.resolution))})()}edit(){var e=this;return(0,c.Z)(function*(){e.onEdit.emit(e.stopwatch.id)})()}delete(){var e=this;return(0,c.Z)(function*(){(yield e.utils.confirm("Are you sure?","Delete "+e.stopwatch.title))?(yield e.stopwatchesService.delete(e.stopwatch),e.utils.showToast("Deleted"),e.onDelete.emit(!0)):e.onDelete.emit(!1)})()}startTimer(){this.startTime=(new Date).getTime(),this.tInterval=setInterval(()=>{this.getShowTime()},this.resolution),this.paused=0,this.running=1,this.saveCurrentState(),this.startNotification(),this.stopwatchesService.setCurrentStopwatch(this.stopwatch)}loadItem(e){var n=this;return new Promise(function(){var i=(0,c.Z)(function*(r){let l=yield n.storage.getString(n.stopwatch.id+"_"+e,null);null!=l&&(n[e+""]="number"==typeof n[e+""]?parseFloat(l):l),r()});return function(r){return i.apply(this,arguments)}}())}saveItem(e,n){return this.storage.setItem(this.stopwatch.id+"_"+e,n)}loadCurrentState(){var e=this;return(0,c.Z)(function*(){return new Promise(function(){var n=(0,c.Z)(function*(i){let r=[];for(var l=0;l<h.P_.STOPWATCHES_FIELDS.length;l++)r.push(e.loadItem(h.P_.STOPWATCHES_FIELDS[l]));yield Promise.all(r),i()});return function(i){return n.apply(this,arguments)}}())})()}saveCurrentState(){var e=this;return(0,c.Z)(function*(){let n=[];for(var i=0;i<h.P_.STOPWATCHES_FIELDS.length;i++){let r=h.P_.STOPWATCHES_FIELDS[i];n.push(e.saveItem(r,e[r]))}yield Promise.all(n)})()}pauseTimer(){this.difference&&(this.paused||(clearInterval(this.tInterval),this.savedTime=this.difference,this.paused=1,this.running=0,this.saveCurrentState(),this.stopNotification()))}processTimesheet(){var e=this;return(0,c.Z)(function*(){return new Promise(function(){var n=(0,c.Z)(function*(i){var l;0===e.difference?(i(!0),e.navController.navigateRoot("/create-time/stopwatch/"+e.stopwatch.id)):0===e.stopwatch.strategy?(e.pauseTimer(),(yield e.alertController.create({header:"Create time",message:"Do you want to edit the timeentry before creating it?",buttons:[{text:"Edit before create",handler:(l=(0,c.Z)(function*(){i(!0),e.navController.navigateRoot("/create-time/stopwatch/"+e.stopwatch.id)}),function(){return l.apply(this,arguments)})},{text:"Create without edit",handler:()=>{i(!0),e.createTimesheet()}},{text:"Continue stopwatch",role:"cancel",handler:()=>{e.startTimer()}},{text:"Reset stopwatch",cssClass:"secondary",handler:()=>{i(!0)}}]})).present()):1===e.stopwatch.strategy?(yield e.createTimesheet(),i(!0)):2===e.stopwatch.strategy?(e.navController.navigateRoot("/create-time/stopwatch/"+e.stopwatch.id),i(!0)):(console.error("Strategy not implemented"),i(!1))});return function(i){return n.apply(this,arguments)}}())})()}createTimesheet(){var e=this;return new Promise(function(){var n=(0,c.Z)(function*(i){let r=yield e.stopwatchesService.get(e.stopwatch.id);r=Object.assign(new C.u,e.stopwatch);let l=yield r.toTimesheet((yield e.apiService.getUser()).id),u=60*(yield e.storage.getNumber(h.P_.SETTINGS_STEPS)),m=r.timerDisplay.split(":").map(H=>parseInt(H));m[0]>0||m[1]>=u/60?(yield e.apiService.postTimesheet(l),e.utils.showToast("Time entry created"),i(!0)):(e.utils.showToast("Duration below minimum tracking time of "+u/60+"min"),i(!1))});return function(i){return n.apply(this,arguments)}}())}stopTimer(){var e=this;return(0,c.Z)(function*(){(yield e.processTimesheet())?(clearInterval(e.tInterval),e.savedTime=0,e.difference=0,e.paused=0,e.running=0,e.timerDisplay="00:00:00",e.stopNotification(),setTimeout(()=>{e.saveCurrentState()},1e3)):e.pauseTimer()})()}getShowTime(){this.updatedTime=(new Date).getTime(),this.difference=this.savedTime?this.updatedTime-this.startTime+this.savedTime:this.updatedTime-this.startTime;var e=Math.floor(this.difference%864e5/36e5),n=Math.floor(this.difference%36e5/6e4),i=Math.floor(this.difference%6e4/1e3);Math.floor(this.difference%6e4/100),this.timerDisplay=(e<10?"0"+e:e)+":"+(n<10?"0"+n:n)+":"+(i<10?"0"+i:i)}startNotification(){var e=this;return(0,c.Z)(function*(){if(console.log("Start notification"),yield Z.requestPermission())try{cordova.plugins.notification.local.schedule({id:parseInt("0x"+e.stopwatch.id.substring(0,8)),title:yield e.translateService.get("BexTrack").toPromise(),text:yield e.translateService.get("timewatch-is-running").toPromise(),sticky:!0,ongoing:!0,autoClear:!1})}catch(n){console.error("Notificaiton error",n)}else console.warn("No notification permission")})()}stopNotification(){var e=this;return(0,c.Z)(function*(){console.log("Stop notification");try{cordova.plugins.notification.local.cancel(parseInt("0x"+e.stopwatch.id.substring(0,8)))}catch(n){console.error("Notificaiton error",n)}})()}}return o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275directiveInject(f.sK),t.\u0275\u0275directiveInject(g.V),t.\u0275\u0275directiveInject(y.F),t.\u0275\u0275directiveInject(S.W),t.\u0275\u0275directiveInject(x.s),t.\u0275\u0275directiveInject(a.AlertController),t.\u0275\u0275directiveInject(a.NavController))},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["app-stopwatch-template"]],inputs:{stopwatch:"stopwatch"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:33,vars:24,consts:[["slot","start",4,"ngIf"],[4,"ngIf"],["slot","end",1,"controls"],["slot","end",3,"click",4,"ngIf"],["slot","end","color","warning",3,"click",4,"ngIf"],["fill","clear","slot","end"],["color","secondary","slot","end","slot","end",3,"click"],["name","create-outline"],["side","end"],["color","warning",3,"click"],["color","danger",3,"click"],["slot","start"],["src","/assets/paid.png"],["src","/assets/free.png"],["slot","end",3,"click"],["name","play-outline"],["slot","end","color","warning",3,"click"],["name","pause-outline"]],template:function(e,n){1&e&&(t.\u0275\u0275elementStart(0,"ion-item-sliding")(1,"ion-item"),t.\u0275\u0275template(2,P,2,0,"ion-avatar",0),t.\u0275\u0275template(3,E,2,0,"ion-avatar",0),t.\u0275\u0275elementStart(4,"ion-label")(5,"h2"),t.\u0275\u0275text(6),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(7,b,3,4,"p",1),t.\u0275\u0275template(8,D,3,4,"p",1),t.\u0275\u0275template(9,N,3,4,"p",1),t.\u0275\u0275template(10,R,3,4,"p",1),t.\u0275\u0275elementStart(11,"p"),t.\u0275\u0275text(12),t.\u0275\u0275pipe(13,"translate"),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(14,"div",2),t.\u0275\u0275template(15,B,4,3,"ion-button",3),t.\u0275\u0275template(16,j,4,3,"ion-button",3),t.\u0275\u0275template(17,M,4,3,"ion-button",4),t.\u0275\u0275element(18,"br"),t.\u0275\u0275elementStart(19,"ion-button",5),t.\u0275\u0275text(20),t.\u0275\u0275elementEnd(),t.\u0275\u0275element(21,"br"),t.\u0275\u0275elementStart(22,"ion-button",6),t.\u0275\u0275listener("click",function(){return n.stopTimer()}),t.\u0275\u0275element(23,"ion-icon",7),t.\u0275\u0275text(24),t.\u0275\u0275pipe(25,"translate"),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementStart(26,"ion-item-options",8)(27,"ion-item-option",9),t.\u0275\u0275listener("click",function(){return n.edit()}),t.\u0275\u0275text(28),t.\u0275\u0275pipe(29,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(30,"ion-item-option",10),t.\u0275\u0275listener("click",function(){return n.delete()}),t.\u0275\u0275text(31),t.\u0275\u0275pipe(32,"translate"),t.\u0275\u0275elementEnd()()()),2&e&&(t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",n.stopwatch.allowable_bill),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!n.stopwatch.allowable_bill),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(null==n.stopwatch?null:n.stopwatch.title),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.stopwatch?null:n.stopwatch.selectedProjectText),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.stopwatch?null:n.stopwatch.selectedPackageText),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.stopwatch?null:n.stopwatch.selectedClientServiceText),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",null==n.stopwatch?null:n.stopwatch.selectedStatusText),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate2("",t.\u0275\u0275pipeBind1(13,16,"Description"),": ",null==n.stopwatch?null:n.stopwatch.text,""),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",0==n.difference&&(0==n.running||1==n.paused)),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",n.difference>0&&(0==n.running||1==n.paused)),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",1==n.running&&1!=n.paused),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(n.timerDisplay),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate1("\xa0",t.\u0275\u0275pipeBind1(25,18,"Create"),""),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(29,20,"Edit")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(32,22,"Delete")))},dependencies:[d.NgIf,a.IonAvatar,a.IonButton,a.IonIcon,a.IonItem,a.IonItemOption,a.IonItemOptions,a.IonItemSliding,a.IonLabel,f.X$],styles:["ion-button[_ngcontent-%COMP%]{width:110px;height:30px}h2[_ngcontent-%COMP%]{font-weight:700}"]}),o})();function F(o,s){1&o&&(t.\u0275\u0275elementStart(0,"div",7)(1,"ion-grid")(2,"ion-row"),t.\u0275\u0275element(3,"ion-icon",8),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"ion-row")(5,"h1"),t.\u0275\u0275text(6),t.\u0275\u0275pipe(7,"translate"),t.\u0275\u0275elementEnd()()()()),2&o&&(t.\u0275\u0275advance(6),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(7,1,"No stopwatches found")))}function V(o,s){if(1&o){const e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"app-stopwatch-template",9),t.\u0275\u0275listener("onDelete",function(i){t.\u0275\u0275restoreView(e);const r=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(r.delete(i))})("onEdit",function(i){t.\u0275\u0275restoreView(e);const r=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(r.edit(i))}),t.\u0275\u0275elementEnd()}2&o&&t.\u0275\u0275property("stopwatch",s.$implicit)}const O=[{path:"",component:(()=>{class o{constructor(e,n,i){var r=this;this.navController=e,this.stopwatchesService=n,this.storage=i,this.stopwatches=[],this.loading=!1,this.stopwatchesService.stopwatches.subscribe(l=>this.stopwatches=l),this.stopwatchesService.getCurrentStopwatch().subscribe(function(){var l=(0,c.Z)(function*(u){(yield r.storage.getBoolean(h.P_.SETTINGS_STOPWATCH_SINGULAR,h.Of.STOPWATCH_SINGULAR))&&r.stopwatchComponents.filter(m=>m.stopwatch.id!=u.id).map(m=>m.pauseTimer())});return function(u){return l.apply(this,arguments)}}())}doRefresh(e,n=!1){var i=this;return(0,c.Z)(function*(){i.loading=!0,e&&e.target.complete(),setTimeout(()=>{i.loading=!1},1e3)})()}delete(e){var n=this;return(0,c.Z)(function*(){e||n.list.closeSlidingItems()})()}edit(e){var n=this;return(0,c.Z)(function*(){n.navController.navigateRoot("/stopwatch/"+e)})()}}return o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275directiveInject(a.NavController),t.\u0275\u0275directiveInject(S.W),t.\u0275\u0275directiveInject(g.V))},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["app-stopwatches"]],viewQuery:function(e,n){if(1&e&&(t.\u0275\u0275viewQuery(a.IonList,7),t.\u0275\u0275viewQuery(_,5)),2&e){let i;t.\u0275\u0275queryRefresh(i=t.\u0275\u0275loadQuery())&&(n.list=i.first),t.\u0275\u0275queryRefresh(i=t.\u0275\u0275loadQuery())&&(n.stopwatchComponents=i)}},decls:14,vars:5,consts:[["color","primary"],["slot","fixed",3,"ionRefresh"],["class","no-items",4,"ngIf"],[3,"stopwatch","onDelete","onEdit",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed"],["routerLink","/stopwatch/","color","secondary"],["name","add"],[1,"no-items"],["name","stopwatch-outline"],[3,"stopwatch","onDelete","onEdit"]],template:function(e,n){1&e&&(t.\u0275\u0275elementStart(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t.\u0275\u0275text(3),t.\u0275\u0275pipe(4,"translate"),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementStart(5,"ion-content")(6,"ion-refresher",1),t.\u0275\u0275listener("ionRefresh",function(r){return n.doRefresh(r)}),t.\u0275\u0275element(7,"ion-refresher-content"),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(8,F,8,3,"div",2),t.\u0275\u0275elementStart(9,"ion-list"),t.\u0275\u0275template(10,V,1,1,"app-stopwatch-template",3),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(11,"ion-fab",4)(12,"ion-fab-button",5),t.\u0275\u0275element(13,"ion-icon",6),t.\u0275\u0275elementEnd()()()),2&e&&(t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(4,3,"Stopwatches")," "),t.\u0275\u0275advance(5),t.\u0275\u0275property("ngIf",0===n.stopwatches.length&&!n.loading),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngForOf",n.stopwatches))},dependencies:[d.NgForOf,d.NgIf,a.IonContent,a.IonFab,a.IonFabButton,a.IonGrid,a.IonHeader,a.IonIcon,a.IonList,a.IonRefresher,a.IonRefresherContent,a.IonRow,a.IonTitle,a.IonToolbar,a.RouterLinkDelegate,_,w.rH,f.X$]}),o})()}];let k=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=t.\u0275\u0275defineInjector({imports:[w.Bz.forChild(O),w.Bz]}),o})();var A=p(5642);let L=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=t.\u0275\u0275defineInjector({imports:[d.CommonModule,T.FormsModule,a.IonicModule,A.K,f.aw,k]}),o})()}}]);