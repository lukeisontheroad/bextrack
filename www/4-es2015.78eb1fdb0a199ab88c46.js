(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{EWb5:function(e,t,n){"use strict";n.r(t),n.d(t,"ContactsPageModule",(function(){return E}));var o=n("ofXK"),i=n("3Pt+"),a=n("TEn/"),l=n("tyNb"),r=n("mrSG"),s=n("TzAO"),c=n("fXoL"),d=n("oZWX"),m=n("HPR3"),p=n("sYmb");function u(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"div"),c["\u0275\u0275elementStart"](1,"ion-item"),c["\u0275\u0275elementStart"](2,"ion-avatar",6),c["\u0275\u0275element"](3,"ion-skeleton-text",7),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementStart"](4,"ion-label"),c["\u0275\u0275element"](5,"ion-skeleton-text",8),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"]())}function f(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"ion-list"),c["\u0275\u0275template"](1,u,6,0,"div",5),c["\u0275\u0275elementEnd"]()),2&e){const e=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](1),c["\u0275\u0275property"]("ngForOf",e.skeletons)}}function h(e,t){1&e&&c["\u0275\u0275element"](0,"ion-icon",13)}function v(e,t){1&e&&c["\u0275\u0275element"](0,"ion-icon",14)}function x(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"span"),c["\u0275\u0275text"](1,","),c["\u0275\u0275elementEnd"]())}function I(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"p"),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){const e=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate"](e.phone_mobile)}}function g(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"p"),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){const e=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate"](e.phone_fixed)}}function b(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"p"),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){const e=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate"](e.mail)}}function S(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"p"),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){const e=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate"](e.address)}}function y(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"p"),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){const e=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate2"]("",e.postcode," ",e.city,"")}}function _(e,t){if(1&e){const e=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"ion-item-sliding"),c["\u0275\u0275elementStart"](1,"ion-item"),c["\u0275\u0275template"](2,h,1,0,"ion-icon",9),c["\u0275\u0275template"](3,v,1,0,"ion-icon",10),c["\u0275\u0275elementStart"](4,"ion-label"),c["\u0275\u0275elementStart"](5,"h2"),c["\u0275\u0275text"](6),c["\u0275\u0275template"](7,x,2,0,"span",2),c["\u0275\u0275text"](8),c["\u0275\u0275elementEnd"](),c["\u0275\u0275template"](9,I,2,1,"p",2),c["\u0275\u0275template"](10,g,2,1,"p",2),c["\u0275\u0275template"](11,b,2,1,"p",2),c["\u0275\u0275template"](12,S,2,1,"p",2),c["\u0275\u0275template"](13,y,2,2,"p",2),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementStart"](14,"ion-item-options",11),c["\u0275\u0275elementStart"](15,"ion-item-option",12),c["\u0275\u0275listener"]("click",(function(){c["\u0275\u0275restoreView"](e);const n=t.$implicit;return c["\u0275\u0275nextContext"]().export(n)})),c["\u0275\u0275text"](16),c["\u0275\u0275pipe"](17,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",1==e.contact_type_id),c["\u0275\u0275advance"](1),c["\u0275\u0275property"]("ngIf",1!=e.contact_type_id),c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate"](null==e?null:e.name_1),c["\u0275\u0275advance"](1),c["\u0275\u0275property"]("ngIf",e.name_2),c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"](" ",null==e?null:e.name_2,""),c["\u0275\u0275advance"](1),c["\u0275\u0275property"]("ngIf",e.phone_mobile),c["\u0275\u0275advance"](1),c["\u0275\u0275property"]("ngIf",e.phone_fixed),c["\u0275\u0275advance"](1),c["\u0275\u0275property"]("ngIf",e.mail),c["\u0275\u0275advance"](1),c["\u0275\u0275property"]("ngIf",e.address),c["\u0275\u0275advance"](1),c["\u0275\u0275property"]("ngIf",e.postcode||e.city),c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](17,11,"Export"))}}const w=[{path:"",component:(()=>{class e{constructor(e,t,n){this.nativeContacts=e,this.apiService=t,this.utils=n,this.skeletons=new Array(12),this.loading=!0,this.contacts=[],this.filteredContacts=[]}ngOnInit(){this.init()}init(){return Object(r.a)(this,void 0,void 0,(function*(){this.doRefresh(),this.apiService.projectsUpdated.subscribe(()=>this.doRefresh())}))}doRefresh(e){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0,this.contacts=yield this.apiService.getContacts(!0),this.filteredContacts=this.contacts,e&&e.target.complete(),this.loading=!1}))}onSearch(e){let t=e.detail.value.toLowerCase();this.filteredContacts=""===t?this.contacts:this.contacts.filter(e=>-1!=e.name_1.toLowerCase().indexOf(t)||e.name_2&&-1!=e.name_2.toLowerCase().indexOf(t))}getContact(e){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise(t=>Object(r.a)(this,void 0,void 0,(function*(){var n,o;let i=this.nativeContacts.create(),a=!1,l=[["emails","mail"],["phoneNumbers","phone_mobile"],["phoneNumbers","phone_fixed"],["displayName","calculated_name"]];for(var r=0;r<l.length;r++){if("displayName"===l[l[r][0]])return void t({isUpdate:a,contact:i});null!==e[l[r][1]]&&e[l[r][1]].length>0&&(r=l.length+1)}let c=new s.c,d=[];for(e.calculated_name=((null===(n=null==e?void 0:e.name_2)||void 0===n?void 0:n.trim())+" "+(null===(o=null==e?void 0:e.name_1)||void 0===o?void 0:o.trim())).trim(),r=0;r<l.length;r++)null!==e[l[r][1]]&&e[l[r][1]].length>0&&(console.log("set filter to "+e[l[r][1]]),c.filter=e[l[r][1]],c.multiple=!1,d=yield this.nativeContacts.find([l[r][0]],c),console.log("result",d),1===d.length&&(a=!0,i=d[0],r=l.length+1));t({isUpdate:a,contact:i})})))}))}export(e){var t,n;return Object(r.a)(this,void 0,void 0,(function*(){let o=yield this.getContact(e),i=o.contact;console.log("name",e),i.name=new s.d(null,null===(t=null==e?void 0:e.name_1)||void 0===t?void 0:t.trim(),null===(n=null==e?void 0:e.name_2)||void 0===n?void 0:n.trim()),i.addresses=[new s.a(!0,"work",null,e.address,e.city,null,e.postcode+"")],i.note=e.remarks,i.birthday=e.birthday;let a=[];e.phone_mobile&&a.push(new s.b("mobile",e.phone_mobile)),e.phone_fixed&&a.push(new s.b("work",e.phone_fixed)),e.phone_fixed_second&&a.push(new s.b("home",e.phone_fixed_second)),a.length>0&&(i.phoneNumbers=a);let l=[];e.mail&&l.push(new s.b("work",e.mail)),e.mail_second&&l.push(new s.b("private",e.mail_second)),l.length>0&&(i.emails=l),i.save().then(()=>{this.utils.showToast(o.isUpdate?"Updated":"Created")},e=>{this.utils.showToast("Export failed")})}))}}return e.\u0275fac=function(t){return new(t||e)(c["\u0275\u0275directiveInject"](s.e),c["\u0275\u0275directiveInject"](d.a),c["\u0275\u0275directiveInject"](m.a))},e.\u0275cmp=c["\u0275\u0275defineComponent"]({type:e,selectors:[["app-contacts"]],decls:11,vars:5,consts:[["color","primary"],["debounce","500",3,"ionChange"],[4,"ngIf"],["approxItemHeight","40px",3,"items"],[4,"virtualItem"],[4,"ngFor","ngForOf"],["slot","start"],["animated",""],["animated","",2,"width","60%"],["slot","start","name","business-outline",4,"ngIf"],["slot","start","name","person-outline",4,"ngIf"],["side","end"],[3,"click"],["slot","start","name","business-outline"],["slot","start","name","person-outline"]],template:function(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"ion-header",0),c["\u0275\u0275elementStart"](1,"ion-toolbar",0),c["\u0275\u0275elementStart"](2,"ion-title"),c["\u0275\u0275text"](3),c["\u0275\u0275pipe"](4,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementStart"](5,"ion-content"),c["\u0275\u0275elementStart"](6,"ion-searchbar",1),c["\u0275\u0275listener"]("ionChange",(function(e){return t.onSearch(e)})),c["\u0275\u0275elementEnd"](),c["\u0275\u0275template"](7,f,2,1,"ion-list",2),c["\u0275\u0275elementStart"](8,"ion-list"),c["\u0275\u0275elementStart"](9,"ion-virtual-scroll",3),c["\u0275\u0275template"](10,_,18,13,"ion-item-sliding",4),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"]()),2&e&&(c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate1"](" ",c["\u0275\u0275pipeBind1"](4,3,"Contacts")," "),c["\u0275\u0275advance"](4),c["\u0275\u0275property"]("ngIf",t.loading),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("items",t.filteredContacts))},directives:[a.IonHeader,a.IonToolbar,a.IonTitle,a.IonContent,a.IonSearchbar,a.TextValueAccessor,o.NgIf,a.IonList,a.IonVirtualScroll,a.VirtualItem,o.NgForOf,a.IonItem,a.IonAvatar,a.IonSkeletonText,a.IonLabel,a.IonItemSliding,a.IonItemOptions,a.IonItemOption,a.IonIcon],pipes:[p.c],styles:[""]}),e})()}];let C=(()=>{class e{}return e.\u0275mod=c["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=c["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[l.i.forChild(w)],l.i]}),e})(),E=(()=>{class e{}return e.\u0275mod=c["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=c["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[o.CommonModule,i.FormsModule,a.IonicModule,p.b,C]]}),e})()}}]);