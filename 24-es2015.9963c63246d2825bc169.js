(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{dLgr:function(t,e,n){"use strict";n.r(e),n.d(e,"StopwatchesPageModule",(function(){return R}));var i=n("ofXK"),o=n("3Pt+"),s=n("TEn/"),a=n("tyNb"),r=n("mrSG"),l=n("fXoL"),c=n("gcOT"),d=n("mYOz"),p=n("TCge"),h=n("sYmb"),u=n("E2f4"),m=n("HPR3"),f=n("SdGS"),v=n("oZWX");function w(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"ion-avatar",11),l["\u0275\u0275element"](1,"img",12),l["\u0275\u0275elementEnd"]())}function g(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"ion-avatar",11),l["\u0275\u0275element"](1,"img",13),l["\u0275\u0275elementEnd"]())}function I(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"p"),l["\u0275\u0275text"](1),l["\u0275\u0275pipe"](2,"translate"),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]();l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate2"]("",l["\u0275\u0275pipeBind1"](2,2,"Project"),": ",null==t.stopwatch?null:t.stopwatch.selectedProjectText,"")}}function S(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"p"),l["\u0275\u0275text"](1),l["\u0275\u0275pipe"](2,"translate"),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]();l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate2"]("",l["\u0275\u0275pipeBind1"](2,2,"Package"),": ",null==t.stopwatch?null:t.stopwatch.selectedPackageText,"")}}function T(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"p"),l["\u0275\u0275text"](1),l["\u0275\u0275pipe"](2,"translate"),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]();l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate2"]("",l["\u0275\u0275pipeBind1"](2,2,"Service"),": ",null==t.stopwatch?null:t.stopwatch.selectedClientServiceText,"")}}function x(t,e){if(1&t&&(l["\u0275\u0275elementStart"](0,"p"),l["\u0275\u0275text"](1),l["\u0275\u0275pipe"](2,"translate"),l["\u0275\u0275elementEnd"]()),2&t){const t=l["\u0275\u0275nextContext"]();l["\u0275\u0275advance"](1),l["\u0275\u0275textInterpolate2"]("",l["\u0275\u0275pipeBind1"](2,2,"Status"),": ",null==t.stopwatch?null:t.stopwatch.selectedStatusText,"")}}function y(t,e){if(1&t){const t=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"ion-button",14),l["\u0275\u0275listener"]("click",(function(){return l["\u0275\u0275restoreView"](t),l["\u0275\u0275nextContext"]().startTimer()})),l["\u0275\u0275element"](1,"ion-icon",15),l["\u0275\u0275text"](2),l["\u0275\u0275pipe"](3,"translate"),l["\u0275\u0275elementEnd"]()}2&t&&(l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate1"]("\xa0",l["\u0275\u0275pipeBind1"](3,1,"Start"),""))}function b(t,e){if(1&t){const t=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"ion-button",14),l["\u0275\u0275listener"]("click",(function(){return l["\u0275\u0275restoreView"](t),l["\u0275\u0275nextContext"]().startTimer()})),l["\u0275\u0275element"](1,"ion-icon",15),l["\u0275\u0275text"](2),l["\u0275\u0275pipe"](3,"translate"),l["\u0275\u0275elementEnd"]()}2&t&&(l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate1"]("\xa0",l["\u0275\u0275pipeBind1"](3,1,"Continue"),""))}function E(t,e){if(1&t){const t=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"ion-button",16),l["\u0275\u0275listener"]("click",(function(){return l["\u0275\u0275restoreView"](t),l["\u0275\u0275nextContext"]().pauseTimer()})),l["\u0275\u0275element"](1,"ion-icon",17),l["\u0275\u0275text"](2),l["\u0275\u0275pipe"](3,"translate"),l["\u0275\u0275elementEnd"]()}2&t&&(l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate1"]("\xa0",l["\u0275\u0275pipeBind1"](3,1,"Pause"),""))}const{LocalNotifications:C}=c.Plugins;let j=(()=>{class t{constructor(t,e,n,i,o,s,a){this.translateService=t,this.storage=e,this.utils=n,this.stopwatchesService=i,this.apiService=o,this.alertController=s,this.navController=a,this.onEdit=new l.EventEmitter,this.onDelete=new l.EventEmitter,this.timerDisplay="00:00:00",this.difference=0,this.savedTime=0,this.paused=0,this.running=0,this.resolution=100}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){yield this.loadCurrentState(),1===this.running&&0===this.paused&&(this.tInterval=setInterval(()=>{this.getShowTime()},this.resolution))}))}edit(){return Object(r.a)(this,void 0,void 0,(function*(){this.onEdit.emit(this.stopwatch.id)}))}delete(){return Object(r.a)(this,void 0,void 0,(function*(){(yield this.utils.confirm("Are you sure?","Delete "+this.stopwatch.title))?(yield this.stopwatchesService.delete(this.stopwatch),this.utils.showToast("Deleted"),this.onDelete.emit(!0)):this.onDelete.emit(!1)}))}startTimer(){this.startTime=(new Date).getTime(),this.tInterval=setInterval(()=>{this.getShowTime()},this.resolution),this.paused=0,this.running=1,this.saveCurrentState(),this.startNotification(),this.stopwatchesService.setCurrentStopwatch(this.stopwatch)}loadItem(t){return new Promise(e=>Object(r.a)(this,void 0,void 0,(function*(){let n=yield this.storage.getString(this.stopwatch.id+"_"+t,null);null!=n&&(this[t+""]="number"==typeof this[t+""]?parseFloat(n):n),e()})))}saveItem(t,e){return this.storage.setItem(this.stopwatch.id+"_"+t,e)}loadCurrentState(){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise(t=>Object(r.a)(this,void 0,void 0,(function*(){let e=[];for(var n=0;n<p.b.STOPWATCHES_FIELDS.length;n++)e.push(this.loadItem(p.b.STOPWATCHES_FIELDS[n]));yield Promise.all(e),t()})))}))}saveCurrentState(){return Object(r.a)(this,void 0,void 0,(function*(){let t=[];for(var e=0;e<p.b.STOPWATCHES_FIELDS.length;e++){let n=p.b.STOPWATCHES_FIELDS[e];t.push(this.saveItem(n,this[n]))}yield Promise.all(t)}))}pauseTimer(){this.difference&&(this.paused||(clearInterval(this.tInterval),this.savedTime=this.difference,this.paused=1,this.running=0,this.saveCurrentState(),this.stopNotification()))}processTimesheet(){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise(t=>Object(r.a)(this,void 0,void 0,(function*(){0===this.difference?(t(!0),this.navController.navigateRoot("/create-time/stopwatch/"+this.stopwatch.id)):0===this.stopwatch.strategy?(this.pauseTimer(),(yield this.alertController.create({header:"Create time",message:"Do you want to edit the timeentry before creating it?",buttons:[{text:"Edit before create",handler:()=>Object(r.a)(this,void 0,void 0,(function*(){t(!0),this.navController.navigateRoot("/create-time/stopwatch/"+this.stopwatch.id)}))},{text:"Create without edit",handler:()=>{t(!0),this.createTimesheet()}},{text:"Continue stopwatch",role:"cancel",handler:()=>{this.startTimer()}},{text:"Reset stopwatch",cssClass:"secondary",handler:()=>{t(!0)}}]})).present()):1===this.stopwatch.strategy?(yield this.createTimesheet(),t(!0)):2===this.stopwatch.strategy?(this.navController.navigateRoot("/create-time/stopwatch/"+this.stopwatch.id),t(!0)):(console.error("Strategy not implemented"),t(!1))})))}))}createTimesheet(){return new Promise(t=>Object(r.a)(this,void 0,void 0,(function*(){let e=yield this.stopwatchesService.get(this.stopwatch.id);e=Object.assign(new d.a,this.stopwatch);let n=yield e.toTimesheet((yield this.apiService.getUser()).id),i=60*(yield this.storage.getNumber(p.b.SETTINGS_STEPS)),o=e.timerDisplay.split(":").map(t=>parseInt(t));o[0]>0||o[1]>=i/60?(yield this.apiService.postTimesheet(n),this.utils.showToast("Time entry created"),t(!0)):(this.utils.showToast("Duration below minimum tracking time of "+i/60+"min"),t(!1))})))}stopTimer(){return Object(r.a)(this,void 0,void 0,(function*(){(yield this.processTimesheet())?(clearInterval(this.tInterval),this.savedTime=0,this.difference=0,this.paused=0,this.running=0,this.timerDisplay="00:00:00",this.stopNotification(),setTimeout(()=>{this.saveCurrentState()},1e3)):this.pauseTimer()}))}getShowTime(){this.updatedTime=(new Date).getTime(),this.difference=this.savedTime?this.updatedTime-this.startTime+this.savedTime:this.updatedTime-this.startTime;var t=Math.floor(this.difference%864e5/36e5),e=Math.floor(this.difference%36e5/6e4),n=Math.floor(this.difference%6e4/1e3);Math.floor(this.difference%6e4/100),this.timerDisplay=(t<10?"0"+t:t)+":"+(e<10?"0"+e:e)+":"+(n<10?"0"+n:n)}startNotification(){return Object(r.a)(this,void 0,void 0,(function*(){if(console.log("Start notification"),yield C.requestPermission())try{cordova.plugins.notification.local.schedule({id:parseInt("0x"+this.stopwatch.id.substring(0,8)),title:yield this.translateService.get("BexTrack").toPromise(),text:yield this.translateService.get("timewatch-is-running").toPromise(),sticky:!0,ongoing:!0,autoClear:!1})}catch(t){console.error("Notificaiton error",t)}else console.warn("No notification permission")}))}stopNotification(){return Object(r.a)(this,void 0,void 0,(function*(){console.log("Stop notification");try{cordova.plugins.notification.local.cancel(parseInt("0x"+this.stopwatch.id.substring(0,8)))}catch(t){console.error("Notificaiton error",t)}}))}}return t.\u0275fac=function(e){return new(e||t)(l["\u0275\u0275directiveInject"](h.d),l["\u0275\u0275directiveInject"](u.a),l["\u0275\u0275directiveInject"](m.a),l["\u0275\u0275directiveInject"](f.a),l["\u0275\u0275directiveInject"](v.a),l["\u0275\u0275directiveInject"](s.AlertController),l["\u0275\u0275directiveInject"](s.NavController))},t.\u0275cmp=l["\u0275\u0275defineComponent"]({type:t,selectors:[["app-stopwatch-template"]],inputs:{stopwatch:"stopwatch"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},decls:33,vars:24,consts:[["slot","start",4,"ngIf"],[4,"ngIf"],["slot","end",1,"controls"],["slot","end",3,"click",4,"ngIf"],["slot","end","color","warning",3,"click",4,"ngIf"],["fill","clear","slot","end"],["color","secondary","slot","end","slot","end",3,"click"],["name","create-outline"],["side","end"],["color","warning",3,"click"],["color","danger",3,"click"],["slot","start"],["src","/assets/paid.png"],["src","/assets/free.png"],["slot","end",3,"click"],["name","play-outline"],["slot","end","color","warning",3,"click"],["name","pause-outline"]],template:function(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"ion-item-sliding"),l["\u0275\u0275elementStart"](1,"ion-item"),l["\u0275\u0275template"](2,w,2,0,"ion-avatar",0),l["\u0275\u0275template"](3,g,2,0,"ion-avatar",0),l["\u0275\u0275elementStart"](4,"ion-label"),l["\u0275\u0275elementStart"](5,"h2"),l["\u0275\u0275text"](6),l["\u0275\u0275elementEnd"](),l["\u0275\u0275template"](7,I,3,4,"p",1),l["\u0275\u0275template"](8,S,3,4,"p",1),l["\u0275\u0275template"](9,T,3,4,"p",1),l["\u0275\u0275template"](10,x,3,4,"p",1),l["\u0275\u0275elementStart"](11,"p"),l["\u0275\u0275text"](12),l["\u0275\u0275pipe"](13,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](14,"div",2),l["\u0275\u0275template"](15,y,4,3,"ion-button",3),l["\u0275\u0275template"](16,b,4,3,"ion-button",3),l["\u0275\u0275template"](17,E,4,3,"ion-button",4),l["\u0275\u0275element"](18,"br"),l["\u0275\u0275elementStart"](19,"ion-button",5),l["\u0275\u0275text"](20),l["\u0275\u0275elementEnd"](),l["\u0275\u0275element"](21,"br"),l["\u0275\u0275elementStart"](22,"ion-button",6),l["\u0275\u0275listener"]("click",(function(){return e.stopTimer()})),l["\u0275\u0275element"](23,"ion-icon",7),l["\u0275\u0275text"](24),l["\u0275\u0275pipe"](25,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](26,"ion-item-options",8),l["\u0275\u0275elementStart"](27,"ion-item-option",9),l["\u0275\u0275listener"]("click",(function(){return e.edit()})),l["\u0275\u0275text"](28),l["\u0275\u0275pipe"](29,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](30,"ion-item-option",10),l["\u0275\u0275listener"]("click",(function(){return e.delete()})),l["\u0275\u0275text"](31),l["\u0275\u0275pipe"](32,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t&&(l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("ngIf",e.stopwatch.allowable_bill),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",!e.stopwatch.allowable_bill),l["\u0275\u0275advance"](3),l["\u0275\u0275textInterpolate"](null==e.stopwatch?null:e.stopwatch.title),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",null==e.stopwatch?null:e.stopwatch.selectedProjectText),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",null==e.stopwatch?null:e.stopwatch.selectedPackageText),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",null==e.stopwatch?null:e.stopwatch.selectedClientServiceText),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",null==e.stopwatch?null:e.stopwatch.selectedStatusText),l["\u0275\u0275advance"](2),l["\u0275\u0275textInterpolate2"]("",l["\u0275\u0275pipeBind1"](13,16,"Description"),": ",null==e.stopwatch?null:e.stopwatch.text,""),l["\u0275\u0275advance"](3),l["\u0275\u0275property"]("ngIf",0==e.difference&&(0==e.running||1==e.paused)),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",e.difference>0&&(0==e.running||1==e.paused)),l["\u0275\u0275advance"](1),l["\u0275\u0275property"]("ngIf",1==e.running&&1!=e.paused),l["\u0275\u0275advance"](3),l["\u0275\u0275textInterpolate"](e.timerDisplay),l["\u0275\u0275advance"](4),l["\u0275\u0275textInterpolate1"]("\xa0",l["\u0275\u0275pipeBind1"](25,18,"Create"),""),l["\u0275\u0275advance"](4),l["\u0275\u0275textInterpolate"](l["\u0275\u0275pipeBind1"](29,20,"Edit")),l["\u0275\u0275advance"](3),l["\u0275\u0275textInterpolate"](l["\u0275\u0275pipeBind1"](32,22,"Delete")))},directives:[s.IonItemSliding,s.IonItem,i.NgIf,s.IonLabel,s.IonButton,s.IonIcon,s.IonItemOptions,s.IonItemOption,s.IonAvatar],pipes:[h.c],styles:["ion-button[_ngcontent-%COMP%]{width:110px;height:30px}h2[_ngcontent-%COMP%]{font-weight:700}"]}),t})();function O(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"div",7),l["\u0275\u0275elementStart"](1,"ion-grid"),l["\u0275\u0275elementStart"](2,"ion-row"),l["\u0275\u0275element"](3,"ion-icon",8),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](4,"ion-row"),l["\u0275\u0275elementStart"](5,"h1"),l["\u0275\u0275text"](6),l["\u0275\u0275pipe"](7,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t&&(l["\u0275\u0275advance"](6),l["\u0275\u0275textInterpolate"](l["\u0275\u0275pipeBind1"](7,1,"No stopwatches found")))}function P(t,e){if(1&t){const t=l["\u0275\u0275getCurrentView"]();l["\u0275\u0275elementStart"](0,"app-stopwatch-template",9),l["\u0275\u0275listener"]("onDelete",(function(e){return l["\u0275\u0275restoreView"](t),l["\u0275\u0275nextContext"]().delete(e)}))("onEdit",(function(e){return l["\u0275\u0275restoreView"](t),l["\u0275\u0275nextContext"]().edit(e)})),l["\u0275\u0275elementEnd"]()}2&t&&l["\u0275\u0275property"]("stopwatch",e.$implicit)}const D=[{path:"",component:(()=>{class t{constructor(t,e,n){this.navController=t,this.stopwatchesService=e,this.storage=n,this.stopwatches=[],this.loading=!1,this.stopwatchesService.stopwatches.subscribe(t=>this.stopwatches=t),this.stopwatchesService.getCurrentStopwatch().subscribe(t=>Object(r.a)(this,void 0,void 0,(function*(){(yield this.storage.getBoolean(p.b.SETTINGS_STOPWATCH_SINGULAR,p.a.STOPWATCH_SINGULAR))&&this.stopwatchComponents.filter(e=>e.stopwatch.id!=t.id).map(t=>t.pauseTimer())})))}doRefresh(t,e=!1){return Object(r.a)(this,void 0,void 0,(function*(){this.loading=!0,t&&t.target.complete(),setTimeout(()=>{this.loading=!1},1e3)}))}delete(t){return Object(r.a)(this,void 0,void 0,(function*(){t||this.list.closeSlidingItems()}))}edit(t){return Object(r.a)(this,void 0,void 0,(function*(){this.navController.navigateRoot("/stopwatch/"+t)}))}}return t.\u0275fac=function(e){return new(e||t)(l["\u0275\u0275directiveInject"](s.NavController),l["\u0275\u0275directiveInject"](f.a),l["\u0275\u0275directiveInject"](u.a))},t.\u0275cmp=l["\u0275\u0275defineComponent"]({type:t,selectors:[["app-stopwatches"]],viewQuery:function(t,e){var n;1&t&&(l["\u0275\u0275staticViewQuery"](s.IonList,!0),l["\u0275\u0275viewQuery"](j,!0)),2&t&&(l["\u0275\u0275queryRefresh"](n=l["\u0275\u0275loadQuery"]())&&(e.list=n.first),l["\u0275\u0275queryRefresh"](n=l["\u0275\u0275loadQuery"]())&&(e.stopwatchComponents=n))},decls:14,vars:5,consts:[["color","primary"],["slot","fixed",3,"ionRefresh"],["class","no-items",4,"ngIf"],[3,"stopwatch","onDelete","onEdit",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed"],["routerLink","/stopwatch/","color","secondary"],["name","add"],[1,"no-items"],["name","stopwatch-outline"],[3,"stopwatch","onDelete","onEdit"]],template:function(t,e){1&t&&(l["\u0275\u0275elementStart"](0,"ion-header"),l["\u0275\u0275elementStart"](1,"ion-toolbar",0),l["\u0275\u0275elementStart"](2,"ion-title"),l["\u0275\u0275text"](3),l["\u0275\u0275pipe"](4,"translate"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](5,"ion-content"),l["\u0275\u0275elementStart"](6,"ion-refresher",1),l["\u0275\u0275listener"]("ionRefresh",(function(t){return e.doRefresh(t)})),l["\u0275\u0275element"](7,"ion-refresher-content"),l["\u0275\u0275elementEnd"](),l["\u0275\u0275template"](8,O,8,3,"div",2),l["\u0275\u0275elementStart"](9,"ion-list"),l["\u0275\u0275template"](10,P,1,1,"app-stopwatch-template",3),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementStart"](11,"ion-fab",4),l["\u0275\u0275elementStart"](12,"ion-fab-button",5),l["\u0275\u0275element"](13,"ion-icon",6),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"](),l["\u0275\u0275elementEnd"]()),2&t&&(l["\u0275\u0275advance"](3),l["\u0275\u0275textInterpolate1"](" ",l["\u0275\u0275pipeBind1"](4,3,"Stopwatches")," "),l["\u0275\u0275advance"](5),l["\u0275\u0275property"]("ngIf",0===e.stopwatches.length&&!e.loading),l["\u0275\u0275advance"](2),l["\u0275\u0275property"]("ngForOf",e.stopwatches))},directives:[s.IonHeader,s.IonToolbar,s.IonTitle,s.IonContent,s.IonRefresher,s.IonRefresherContent,i.NgIf,s.IonList,i.NgForOf,s.IonFab,s.IonFabButton,s.RouterLinkDelegate,a.h,s.IonIcon,s.IonGrid,s.IonRow,j],pipes:[h.c],styles:[""]}),t})()}];let k=(()=>{class t{}return t.\u0275mod=l["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=l["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[a.i.forChild(D)],a.i]}),t})();var N=n("j1ZV");let R=(()=>{class t{}return t.\u0275mod=l["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=l["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[i.CommonModule,o.FormsModule,s.IonicModule,N.a,h.b,k]]}),t})()}}]);